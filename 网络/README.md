## OSI 七层模型，和网络五层模型

![](http://dev.biubiupiu.cn/20191124112325.png)

## tcp/ip协议、http协议、socket

ip协议是网络层协议，tcp协议是运输层协议，http协议是应用层协议

![](http://dev.biubiupiu.cn/20191128235324.png)

[参考](https://blog.csdn.net/Pk_zsq/article/details/6087367)


## TCP和UDP

都是传输层协议，只不过tcp是面向连接的，他通过三次握手保证了连接的稳定性和可靠性。udp协议是无连接的，所以不可靠但是传输较快

![](http://dev.biubiupiu.cn/20191128235904.png)


## http 和 https

https在http和tcp之间加入了一层SSL层

![](http://dev.biubiupiu.cn/20191129000256.png)

## 一个tcp连接是否在完成了http请求后会断开？

在 `HTTP/1.0` 中，一个服务器在发送完一个 `HTTP` 响应后，会断开 `TCP` 链接。但是这样每次请求都会重新建立和断开 `TCP` 连接，代价过大。所以虽然标准中没有设定，某些服务器对 `Connection: keep-alive` 的 `Header` 进行了支持。意思是说，完成这个 `HTTP` 请求之后，不要断开 `HTTP` 请求使用的 `TCP` 连接。这样的好处是连接可以被重新使用，之后发送 `HTTP` 请求的时候不需要重新建立 `TCP` 连接，以及如果维持连接，那么 `SSL` 的开销也可以避免。


持久连接：既然维持 TCP 连接好处这么多，HTTP/1.1 就把 Connection 头写进标准，并且默认开启持久连接，除非请求中写明 Connection: close，那么浏览器和服务器之间是会维持一段时间的 TCP 连接，不会一个请求结束就断掉。

**默认情况下建立 TCP 连接不会断开，只有在请求报头中声明 Connection: close 才会在请求完成后关闭连接。**

## 一个tcp连接是否可以发送多个http请求

**如果维持连接，一个 TCP 连接是可以发送多个 HTTP 请求的。**

## 一个 TCP 连接中 HTTP 请求发送可以一起发送么（比如一起发三个请求，再三个响应一起接收）？

`HTTP/1.1` 存在一个问题，单个 `TCP` 连接在同一时刻只能处理一个请求，意思是说：两个请求的生命周期不能重叠，任意两个 `HTTP` 请求从开始到结束的时间在同一个 `TCP` 连接里不能重叠。

![](http://dev.biubiupiu.cn/20191202092829.png)

但是，HTTP2 提供了 Multiplexing 多路传输特性，可以在一个 TCP 连接中同时完成多个 HTTP 请求。至于 Multiplexing 具体怎么实现的就是另一个问题了。我们可以看一下使用 HTTP2 的效果。

![](http://dev.biubiupiu.cn/20191202092926.png)

绿色是发起请求到请求返回的等待时间，蓝色是响应的下载时间，可以看到都是在同一个 Connection，并行完成的

所以这个问题也有了答案：在 HTTP/1.1 存在 Pipelining 技术可以完成这个多个请求同时发送，但是由于浏览器默认关闭，所以可以认为这是不可行的。

在 HTTP2 中由于 Multiplexing 特点的存在，多个 HTTP 请求可以在同一个 TCP 连接中并行进行。

那么在 HTTP/1.1 时代，浏览器是如何提高页面加载效率的呢？主要有下面两点：
+ 维持和服务器已经建立的 TCP 连接，在同一连接上顺序处理多个请求。
+ 和服务器建立多个 TCP 连接。

**所以在http2时代是可以一个tcp连接多个http并行处理的，在http1.1时代，由于浏览器默认关闭pipelining所以不能并行处理多个http请求。**

## 为什么有的时候刷新页面不需要重新建立 SSL 连接？

TCP 连接有的时候会被浏览器和服务端维持一段时间。TCP 不需要重新建立，SSL 自然也会用之前的。

## 浏览器对同一 Host 建立 TCP 连接到数量有没有限制？

假设我们还处在 HTTP/1.1 时代，那个时候没有多路传输，当浏览器拿到一个有几十张图片的网页该怎么办呢？肯定不能只开一个 TCP 连接顺序下载，那样用户肯定等的很难受，但是如果每个图片都开一个 TCP 连接发 HTTP 请求，那电脑或者服务器都可能受不了，要是有 1000 张图片的话总不能开 1000 个TCP 连接吧，你的电脑同意 NAT 也不一定会同意。

所以答案是：**有。Chrome 最多允许对同一个 Host 建立六个 TCP 连接。不同的浏览器有一些区别。**

## 收到的 HTML 如果包含几十个图片标签，这些图片是以什么方式、什么顺序、建立了多少连接、使用什么协议被下载下来的呢？

如果图片都是 `HTTPS` 连接并且在同一个域名下，那么浏览器在 `SSL` 握手之后会和服务器商量能不能用 `HTTP2`，如果能的话就使用 `Multiplexing` 功能在这个连接上进行多路传输。不过也未必会所有挂在这个域名的资源都会使用一个 `TCP` 连接去获取，但是可以确定的是 `Multiplexing` 很可能会被用到。

如果发现用不了 `HTTP2` 呢？或者用不了 `HTTPS`（现实中的 `HTTP2` 都是在 `HTTPS` 上实现的，所以也就是只能使用 `HTTP/1.1）`。那浏览器就会在一个 `HOST` 上建立多个 `TCP` 连接，连接数量的最大限制取决于浏览器设置，这些连接会在空闲的时候被浏览器用来发送新的请求，如果所有的连接都正在发送请求呢？那其他的请求就只能等等了。

[知乎问题参考](https://www.zhihu.com/people/zhong-zhi-qiang-80-46/activities)
